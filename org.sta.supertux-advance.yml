app-id: org.sta.supertux-advance
sdk: org.freedesktop.Sdk
runtime: org.freedesktop.Platform
runtime-version: "25.08"
command: runner.sh
finish-args:
  - --device=dri
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=pulseaudio
modules:
  - modules/cURL.json
  - modules/SDL3.json
  - modules/SDL2.json
  - modules/SDL2_gfx.json
  - modules/SDL2_image.json
  - modules/SDL2_mixer.json
  - modules/SDL2_net.json
  - modules/SDL2_ttf.json
  - modules/PhysFS.json
  - modules/libgit2.json
  - name: brux
    buildsystem: meson
    subdir: rte
    config-opts:
      - -Dbuildtype=release
    sources:
      - type: git
        url: https://codeberg.org/KelvinShadewing/brux-gdk
        branch: main
        disable-fsckobjects: true
    post-install:
      - mv /app/brux /app/bin/brux
  - name: supertux-advance
    buildsystem: simple
    build-commands:
      - install -D runner.sh /app/bin/runner.sh
      - mkdir /app/bin/sta && cp -r * /app/bin/sta/
      - install -D $FLATPAK_ID.appdata.xml /app/share/metainfo/$FLATPAK_ID.appdata.xml
      - install -D $FLATPAK_ID.desktop /app/share/applications/$FLATPAK_ID.desktop
      - install -D $FLATPAK_ID.svg /app/share/icons/hicolor/scalable/apps/$FLATPAK_ID.svg
      #- cd /app/bin/sta && git apply /run/build/supertux-advance/0.2.1-InvertFix-PhysicsFS-Backport.diff
      #- cd /app/bin/sta && git apply /run/build/supertux-advance/trigger-line-edit.diff
    no-autogen: true
    sources:
      - type: git
        url: https://codeberg.org/KelvinShadewing/supertux-advance
        branch: main
        disable-fsckobjects: true
      - type: file
        path: org.sta.supertux-advance.appdata.xml
      - type: file
        path: org.sta.supertux-advance.desktop
      - type: file
        path: org.sta.supertux-advance.svg
      - type: file
        path: runner.sh
